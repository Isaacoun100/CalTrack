<div class=" page-bg">
  <div class="d-flex vh-100">

    <div class="d-flex vh-100">
      <div class="bg-dark text-white p-3" style="width: 240px;">
        <h4 class="mb-4">CalTrack</h4>
        <ul class="nav flex-column gap-2">
          <li class="nav-item">
            <button class="btn btn-outline-light w-100" (click)="goToDashboard()">Dashboard</button>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-light w-100" (click)="goToGestAlimentos()">Gestión Alimentos</button>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-light w-100 active bg-primary rounded bg-white" (click)="goToVerUsuarios()">Ver Usuarios</button>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-info w-100 mt-2" (click)="goToAddNutri()">+ Nuevo Nutricionista</button>
          </li>
          <li class="nav-item mt-auto">
            <button class="btn btn-outline-light w-100" (click)="logout()">Sign Out</button>
          </li>
        </ul>
    </div>

    <div class="flex-grow-1 p-4 bg-light overflow-auto">

      <!-- ASSIGN USER TO NUTRITIONIST -->
<div class="card shadow-sm mb-4">
  <div class="card-body">

    <h5 class="mb-3">Asignar nuevo paciente</h5>

    <div class="d-flex gap-2 align-items-end">

      <div class="flex-grow-1">
        <label class="form-label">Usuario disponible</label>
        <select class="form-select" [(ngModel)]="selectedUserId">
          <option *ngFor="let u of availableUsers" [value]="u.id">
            {{ u.firstName }} {{ u.firstLastName }}
          </option>
        </select>
        </div>          <button
            class="btn btn-success"
            (click)="assignUser()"
            [disabled]="!selectedUserId || assigning">
            {{ assigning ? 'Asignando...' : 'Asignar' }}
          </button>
        </div>

      </div>

      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Dashboard</h2>
        <span class="badge bg-info text-white bg-black">Total Pacientes: {{ patients.length }}</span>
      </div>

  </div>

  <div class="card shadow-sm">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th>Paciente</th>
                  <th>Edad</th>
                  <th class="text-center">Peso (kg)</th>
                  <th class="text-center">Estatura (cm)</th>
                  <th class="text-center">IMC</th>
                  <th class="text-center">Estado</th>
                  <th class="text-end">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let p of patients">
                  <td class="align-middle">
                    <div class="fw-bold">{{ p.firstName }} {{ p.firstLastName }}</div>
                  </td>
                  <td class="align-middle">{{ p.age }} años</td>
                  <td class="text-center align-middle">{{ p.weight }} kg</td>
                  <td class="text-center align-middle">{{ p.height}} cm</td>
                  <td class="text-center align-middle">
                    <span class="badge bg-light text-dark border">
                      {{ calculateIMC(p.weight, p.height) | number:'1.1-1' }}
                    </span>
                  </td>
                  <td class="text-center align-middle">
                    <span [ngClass]="getIMCClass(calculateIMC(p.weight, p.height))">
                      {{ getIMCCategory(calculateIMC(p.weight, p.height)) }}
                    </span>
                  </td>
                  <td class="text-end align-middle">
                    <button class="btn btn-sm btn-outline-primary" (click)="viewDetails(p.id)">
                      Ver Detalles / Metas
                    </button>

                    <button
                      class="btn btn-sm btn-outline-danger ms-2"
                      (click)="unassignUser(p.id)">
                      Desvincular
                    </button>


                  </td>
                </tr>

                <tr *ngIf="patients.length === 0">
                  <td colspan="7" class="text-center py-4 text-muted">
                    No tienes pacientes asignados actualmente.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>