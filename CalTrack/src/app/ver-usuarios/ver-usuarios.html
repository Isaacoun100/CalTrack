<div class="page-bg">
  <div class="d-flex vh-100">
    <div class="bg-dark text-white p-3" style="width: 240px;">
      <h4 class="mb-4">CalTrack</h4>
      <ul class="nav flex-column gap-2">
        <li class="nav-item">
          <button class="btn btn-outline-light w-100" (click)="goToDashboard()">Dashboard</button>
        </li>
        <li class="nav-item">
          <button class="btn btn-outline-light w-100" (click)="goToGestAlimentos()">Gestión Alimentos</button>
        </li>
        <li class="nav-item">
          <button class="btn btn-outline-light w-100 active bg-primary rounded bg-white" (click)="goToVerUsuarios()">Ver Usuarios</button>
        </li>
        <li class="nav-item">
          <button class="btn btn-outline-info w-100 mt-2" (click)="goToAddNutri()">+ Nuevo Nutricionista</button>
        </li>
        <li class="nav-item mt-auto">
          <button class="btn btn-outline-light w-100" (click)="logout()">Sign Out</button>
        </li>
      </ul>
    </div>

    <div class="flex-grow-1 p-4 overflow-auto">
      <div class="row h-100">
        <div class="col-md-3 border-end">
          <h5>Mis Pacientes</h5>
          <div class="list-group mt-3">
            <button *ngFor="let p of patients" 
                    (click)="selectPatient(p)"
                    [class.active]="selectedPatient?.id === p.id"
                    class="list-group-item list-group-item-action">
              {{ p.firstName }} {{ p.firstLastName }}
            </button>
          </div>
        </div>

        <div class="col-md-9" *ngIf="selectedPatient">
          <h3>Expediente: {{ selectedPatient.firstName }} {{ selectedPatient.firstLastName }}</h3>
          
          <div class="row mt-4">
            <div class="col-md-6">
              <div class="card p-3 shadow-sm">
                <h6>Evolución de Peso (kg)</h6>
                <canvas id="weightChart"></canvas>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card p-3 shadow-sm">
                <h6>Consumo Calórico Reciente</h6>
                <canvas id="kcalChart"></canvas>
              </div>
            </div>
          </div>

          <div class="card mt-4 p-4 shadow-sm border-primary">
            <h5>Asignar Nueva Meta Diaria</h5>
            <div class="row g-3 align-items-end">
              <div class="col-md-4">
                <label class="form-label">Límite kcal diario</label>
                <input type="number" class="form-control" [(ngModel)]="nuevaMeta.daily_kcal_limit">
              </div>
              <div class="col-md-4">
                <label class="form-label">Fecha de Inicio</label>
                <input type="date" class="form-control" [(ngModel)]="nuevaMeta.start_date">
              </div>
              <div class="col-md-4">
                <button class="btn btn-primary w-100" (click)="asignarMeta()">Establecer Meta</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-9 d-flex align-items-center justify-content-center" *ngIf="!selectedPatient">
          <p class="text-muted">Seleccione un paciente para ver su evolución y asignar metas.</p>
        </div>
      </div>
    </div>
  </div>
</div>